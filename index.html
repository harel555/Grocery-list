<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×¨×©×™××ª ×”×§× ×™×•×ª ×©×œ×™</title>
    <style>
        body {
            font-family: sans-serif;
            background-color: #f9e3a9;
            color: #00008B;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            direction: rtl;
            text-align: right;
        }
        .container {
            max-width: 1000px; /* ×¨×•×—×‘ ××¡×¤×§ ×œ-2 ×¢××•×“×•×ª */
            margin: 20px auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
            margin-top: 25px;
            margin-bottom: 15px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        td {
            width: 50%; /* 2 ×¢××•×“×•×ª */
            vertical-align: top;
            padding: 8px;
            box-sizing: border-box;
        }
        .product-item {
            background-color: #e9e9e9;
            margin-bottom: 8px;
            padding: 5px 10px; /* ×¤××“×™× ×’ ××•×¤×—×ª */
            border-radius: 5px;
            display: flex; /* ×¤×œ×§×¡×‘×•×§×¡ ×œ×©×•×¨×” ××—×ª ×‘×ª×•×š ×”×ª× */
            align-items: center;
            justify-content: space-between;
            font-size: 0.95em;
            transition: background-color 0.2s ease, border-right 0.2s ease;
            min-height: 50px; /* ×’×•×‘×” ××™× ×™××œ×™ ×¡×‘×™×¨ ×œ×¤×¨×™×˜ ×©×›×•×œ×œ ××¡×¤×¨ ××œ×× ×˜×™× ×‘×©×•×¨×” */
        }
        .product-item:hover {
            background-color: #dcdcdc;
        }
        /* ×§×œ××¡ ×œ×¤×¨×™×˜ ×©× ×‘×—×¨ ×œ×¢×’×œ×” (×™×¨×•×§ ×‘×¦×“) */
        .product-item.selected-for-purchase {
            background-color: #d4edda; /* ×™×¨×•×§ ×‘×”×™×¨ ×™×•×ª×¨ ×œ×‘×—×™×¨×” */
            border-right: 5px solid #28a745; /* ×¤×¡ ×™×¨×•×§ ×œ×™×“ ×¤×¨×™×˜×™× × ×‘×—×¨×™× */
        }
        /* ×§×œ××¡ ×œ×¤×¨×™×˜ ×©×¡×•××Ÿ ×›× ×§× ×” (×§×• ×—×•×¦×” ×•××¤×•×¨) - ×¨×§ ×‘××¦×‘ ×¨×©×™××ª ×§× ×™×•×ª */
        .shopping-list-mode .product-item.purchased {
            text-decoration: line-through;
            color: #888;
            background-color: #f0f0f0;
            border-right: none; /* ×‘×˜×œ ××ª ×”×¤×¡ ×”×™×¨×•×§ ×× ×¡×•××Ÿ ×›× ×§× ×” */
        }

        /* ×¡×¢×™×£ ×”×•×¡×¤×ª ×¤×¨×™×˜ ×—×“×© - ×¢×™×¦×•×‘ */
        .add-new-item-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        .add-new-item-section label {
            font-weight: bold;
            color: #34495e;
        }
        .add-new-item-section input[type="text"],
        .add-new-item-section input[type="number"],
        .add-new-item-section select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9em;
            width: 100%;
            box-sizing: border-box;
        }
        .add-new-item-section button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            width: auto;
            align-self: flex-end;
        }
        .add-new-item-section button:hover {
            background-color: #0056b3;
        }

        /* ×¤×¨×™×˜×™ ×¨×©×™××” - ××œ×× ×˜×™× ×‘×ª×•×š ×”-TD */
        .item-name {
            font-weight: bold;
            flex-shrink: 0;
            margin-left: 10px;
            color: #00008B;
        }
        .quantity-control {
            display: flex;
            align-items: center;
            flex-grow: 1; /* ×××¤×©×¨ ×œ×–×” ×œ×ª×¤×•×¡ ××ª ×¨×•×‘ ×”××§×•× */
            justify-content: flex-start;
            gap: 5px;
            flex-wrap: wrap; /* ×™××¤×©×¨ ×’×œ×™×©×” ×‘×©×•×¨×•×ª ×§×˜× ×•×ª */
        }
        .quantity-control input[type="radio"] {
            margin: 0 2px;
            flex-shrink: 0;
        }
        .quantity-control label {
            font-size: 0.85em;
            color: #555;
            flex-shrink: 0;
        }
        .quantity-control input[type="number"] {
            width: 50px; /* ×¨×•×—×‘ ×§×˜×Ÿ ×™×•×ª×¨ ×œ×©×“×” ××¡×¤×¨ */
            padding: 3px;
            border: 1px solid #ccc;
            border-radius: 3px;
            text-align: center;
            font-size: 0.8em;
            -moz-appearance: textfield;
            appearance: textfield;
            margin-right: 5px; /* ×¨×•×•×— ××™××™×Ÿ ×œ××¡×¤×¨ */
        }
        /* ×”×¡×ª×¨×ª ×›×¤×ª×•×¨×™ ×”×—×¦×™× ×‘×©×“×” ××¡×¤×¨ */
        .quantity-control input[type="number"]::-webkit-outer-spin-button,
        .quantity-control input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* ×›×¤×ª×•×¨ ×•×™ ×©×™×•×¦×’ ×¨×§ ×‘××¦×‘ ×¨×©×™××ª ×§× ×™×•×ª */
        .item-actions .purchased-toggle-btn {
            color: #28a745;
            display: none; /* ××•×¡×ª×¨ ×›×‘×¨×™×¨×ª ××—×“×œ */
        }
        .shopping-list-mode .item-actions .purchased-toggle-btn {
            display: inline-block; /* ××•×¦×’ ×‘××¦×‘ ×¨×©×™××ª ×§× ×™×•×ª */
        }
        /* ×›×¤×ª×•×¨ ×¢×’×œ×” ×™×•×¡×ª×¨ ×‘××¦×‘ ×¨×©×™××ª ×§× ×™×•×ª */
        .shopping-list-mode .item-actions .select-btn {
            display: none; 
        }
        /* ×‘××¦×‘ ×¨×©×™××ª ×§× ×™×•×ª, ×”×¡×ª×¨ ××ª ×‘×§×¨×•×ª ×”×›××•×ª ×•×”×¦×’ ××ª ×”×ª×¦×•×’×” ×”×¡×˜×˜×™×ª */
        .shopping-list-mode .quantity-control {
            display: none !important;
        }
        .shopping-list-mode .quantity-display {
            display: inline-block !important; /* ×”×¦×’ ×›××•×ª ×¡×˜×˜×™×ª */
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }

        /* ×›×¤×ª×•×¨×™ ×©×œ×™×˜×” ×¨××©×™×™× ×œ××¢×œ×” ×•×œ××˜×” */
        .main-controls {
            text-align: center;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap; /* ×™××¤×©×¨ ×’×œ×™×©×” ×‘×©×•×¨×•×ª ×§×˜× ×•×ª */
        }
        .main-controls button {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.2s ease;
        }
        .main-controls button:hover {
            background-color: #5a6268;
        }
        #show-all-btn.active-mode {
            background-color: #007bff;
        }
        #show-all-btn:hover {
            background-color: #0056b3;
        }
        #show-shopping-list-btn.active-mode {
            background-color: #28a745;
        }
        #show-shopping-list-btn:hover {
            background-color: #218838;
        }
        /* ×›×¤×ª×•×¨ ×•×•××˜×¡××¤ */
        .whatsapp-button {
            background-color: #25D366; /* WhatsApp green */
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.2s ease;
            margin-bottom: 20px; /* ×¨×•×•×— ××ª×—×ª ×œ×›×¤×ª×•×¨ */
            margin-top: 10px; /* ×¨×•×•×— ××¢×œ ×œ×›×¤×ª×•×¨ */
        }
        .whatsapp-button:hover {
            background-color: #1DA851;
        }
        .whatsapp-settings {
            margin-top: 15px;
            margin-bottom: 25px;
            padding: 15px;
            background-color: #f0f0f0;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .whatsapp-settings label {
            font-weight: bold;
            color: #34495e;
        }
        .whatsapp-settings input[type="text"] {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9em;
            width: 100%;
            box-sizing: border-box;
        }


        /* ×”×¡×ª×¨×ª ×§×˜×’×•×¨×™×•×ª ×›×©×”×Ÿ ×¨×™×§×•×ª ×‘××¦×‘ ×ª×¦×•×’×ª ×§× ×™×•×ª */
        .category-hidden {
            display: none !important;
        }

        /* Responsive design for mobile (single column) */
        @media (max-width: 768px) {
            body {
                padding: 10px; /* ×¤××“×™× ×’ ×§×˜×Ÿ ×™×•×ª×¨ ×‘×˜×œ×¤×•×Ÿ */
            }
            .container {
                padding: 15px;
                margin: 10px auto; /* ××¨×•×•×— ×§×˜×Ÿ ×™×•×ª×¨ ××”×§×¦×•×•×ª */
            }
            td {
                width: 100%; /* ×ª× ××—×“ ×‘×¨×•×—×‘ ××œ× */
                display: block; /* ×•×•×“× ×©×”×ª× ×ª×•×¤×¡ ×©×•×¨×” ×©×œ××” */
                padding: 5px 0; /* ×¤××“×™× ×’ ××•×¤×—×ª ×‘×¦×“×“×™× */
            }
            .product-item {
                flex-direction: column; /* ×”×¤×•×š ×œ×¢××•×“×” ××—×ª ×‘×ª×•×š ×”×¤×¨×™×˜ */
                align-items: flex-end; /* ×™×™×©×•×¨ ×œ×™××™×Ÿ */
                padding: 10px;
                min-height: auto;
                text-align: right; /* ×•×•×“× ×™×™×©×•×¨ ×˜×§×¡×˜ ×œ×™××™×Ÿ */
            }
            .item-name {
                width: 100%;
                margin-left: 0;
                margin-bottom: 5px;
                text-align: right;
            }
            .quantity-control {
                width: 100%;
                justify-content: flex-end;
                margin-bottom: 10px;
                text-align: right;
            }
            .item-actions {
                width: 100%;
                justify-content: flex-end;
            }
            .add-new-item-section button {
                width: 100%;
                align-self: center;
            }
            .main-controls {
                flex-direction: column;
                gap: 10px;
            }
            .main-controls button {
                width: 100%;
            }
            /* ×›×¤×ª×•×¨ ×”×•×•××˜×¡××¤ ×’× ×™×”×™×” ×‘×¨×•×—×‘ ××œ× */
            .whatsapp-button {
                width: 100%;
                box-sizing: border-box; /* ×›×•×œ×œ ×¤××“×™× ×’ ×•×‘×•×¨×“×¨ ×‘×¨×•×—×‘ */
            }
            .whatsapp-settings input[type="text"] {
                font-size: 1em; /* ×’×•×¤×Ÿ ×§×¦×ª ×™×•×ª×¨ ×’×“×•×œ ×‘×©×“×•×ª ×§×œ×˜ ×‘× ×™×™×“ */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ›’ ×¨×©×™××ª ×”×§× ×™×•×ª ×©×œ×™ ğŸ›’</h1>

        <div class="main-controls">
            <button id="show-shopping-list-btn">×”×¦×’ ×¨×©×™××ª ×§× ×™×•×ª × ×•×›×—×™×ª</button>
            <button id="show-all-btn">×”×¦×’ ××ª ×›×œ ×”××•×¦×¨×™×</button>
        </div>

        <div class="whatsapp-settings">
            <label for="whatsapp-numbers">××¡×¤×¨×™ ×˜×œ×¤×•×Ÿ ×œ×©×œ×™×—×” (××•×¤×¨×“×™× ×‘×¤×¡×™×§):</label>
            <input type="text" id="whatsapp-numbers" value="0506245447,0506232259">
        </div>
        <button class="whatsapp-button" onclick="exportToWhatsApp()">×©×œ×— ×¨×©×™××ª ×§× ×™×•×ª ×œ×•×•×˜×¡××¤</button>

        <div id="vegetables-div">
            <h2>×™×¨×§×•×ª</h2>
            <table id="vegetables-table"><tbody></tbody></table>
        </div>

        <div id="fruits-div">
            <h2>×¤×™×¨×•×ª</h2>
            <table id="fruits-table"><tbody></tbody></table>
        </div>

        <div id="dairy-products-div">
            <h2>××•×¦×¨×™ ×—×œ×‘</h2>
            <table id="dairy-products-table"><tbody></tbody></table>
        </div>

        <div id="meat-products-div">
            <h2>××•×¦×¨×™ ×‘×©×¨</h2>
            <table id="meat-products-table"><tbody></tbody></table>
        </div>

        <div id="fish-products-div">
            <h2>×“×’×™×</h2>
            <table id="fish-products-table"><tbody></tbody></table>
        </div>

        <div id="cleaning-items-div">
            <h2>××•×¦×¨×™ × ×™×§×™×•×Ÿ</h2>
            <table id="cleaning-items-table"><tbody></tbody></table>
        </div>

        <div id="legumes-div">
            <h2>×§×˜× ×™×•×ª</h2>
            <table id="legumes-table"><tbody></tbody></table>
        </div>

        <div id="various-items-div">
            <h2>×©×•× ×•×ª</h2>
            <table id="various-items-table"><tbody></tbody></table>
        </div>


        <div class="add-new-item-section">
            <h2>×”×•×¡×£ ×¤×¨×™×˜ ×—×“×©</h2>
            <label for="new-item-text">×©× ×”×¤×¨×™×˜:</label>
            <input type="text" id="new-item-text" placeholder="×”×›× ×¡ ×©× ×¤×¨×™×˜">

            <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                <label for="new-item-quantity-add">×›××•×ª:</label>
                <input type="number" id="new-item-quantity-add" value="0" min="0" step="0.1" max="99.9" onfocus="this.select()" style="width: 70px;">

                <span id="add-item-unit-controls">
                    <input type="radio" id="add-unit-type-kg" name="add-unit-type" value="kg" checked>
                    <label for="add-unit-type-kg">×§×´×’</label>

                    <input type="radio" id="add-unit-type-units" name="add-unit-type" value="units">
                    <label for="add-unit-type-units">×™×—×™×“×•×ª</label>
                </span>
            </div>

            <label for="category-select">×©×™×™×š ×œ×§×˜×’×•×¨×™×”:</label>
            <select id="category-select">
            </select>
            <button onclick="addNewItem()">×”×•×¡×£ ×¤×¨×™×˜</button>
        </div>

        <div class="add-new-item-section">
            <h2>×”×•×¡×£ ×§×˜×’×•×¨×™×” ×—×“×©×”</h2>
            <label for="new-category-name">×©× ×”×§×˜×’×•×¨×™×” ×”×—×“×©×”:</label>
            <input type="text" id="new-category-name" placeholder="×œ×“×•×’××: '×©×™××•×¨×™×'">
            <button onclick="addNewCategory()">×”×•×¡×£ ×§×˜×’×•×¨×™×”</button>
        </div>

        <button class="whatsapp-button" onclick="exportToWhatsApp()">×©×œ×— ×¨×©×™××ª ×§× ×™×•×ª ×œ×•×•×˜×¡××¤</button>

    </div>

    <script>
        const STORAGE_KEY = 'shoppingListItemsV8'; // ×©×™× ×•×™ ×©× ×”××¤×ª×— ×œ×’×¨×¡×” ×—×“×©×”
        let currentItems = {}; // ××‘× ×” × ×ª×•× ×™× ×©×™×›×™×œ ××ª ×›×œ ×”×§×˜×’×•×¨×™×•×ª ×•×”××•×¦×¨×™×
        const categoryMap = {}; // ××¤×” ×œ×§×™×©×•×¨ ×‘×™×Ÿ ID ×”-UL ×œ×©× ×”×§×˜×’×•×¨×™×” ×”××•×¦×’

        // *******************************************************************
        // ××¤×ª ×›×œ×œ×™× ×œ×™×—×™×“×•×ª ×œ×¤×™ ×§×˜×’×•×¨×™×”
        // *******************************************************************
        const categoryUnitRules = {
            "vegetables-table": { allowKg: true, allowUnits: true, defaultUnitType: "kg" },
            "fruits-table": { allowKg: true, allowUnits: true, defaultUnitType: "kg" },
            "dairy-products-table": { allowKg: true, allowUnits: true, defaultUnitType: "units" }, // ×‘×¨×™×¨×ª ××—×“×œ ×œ××•×¦×¨×™ ×—×œ×‘
            "meat-products-table": { allowKg: true, allowUnits: false, defaultUnitType: "kg" },
            "fish-products-table": { allowKg: true, allowUnits: true, defaultUnitType: "kg" },
            "cleaning-items-table": { allowKg: false, allowUnits: true, defaultUnitType: "units" },
            "legumes-table": { allowKg: false, allowUnits: true, defaultUnitType: "units" },
            "various-items-table": { allowKg: false, allowUnits: true, defaultUnitType: "units" }
            // ×§×˜×’×•×¨×™×•×ª ×—×“×©×•×ª ×™×§×‘×œ×• ×‘×¨×™×¨×ª ××—×“×œ ××• ×©×¦×¨×™×š ×œ×”×•×¡×™×£ ××•×ª×Ÿ ×›××Ÿ
        };

        // ×”×’×“×¨×” ×¨××©×•× ×™×ª ×©×œ ××•×¦×¨×™× (×¨×§ ×× ××™×Ÿ × ×ª×•× ×™× ×©××•×¨×™×)
        const initialProductsData = {
            "vegetables-table": [
                { name: "××œ×¤×¤×•× ×™×", quantity: 0, unit: "×§×´×’", unitType: "kg", selected: false, purchased: false },
                { name: "×¢×’×‘× ×™×•×ª ×©×¨×™", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×¢×’×‘× ×™×•×ª", quantity: 0, unit: "×§×´×’", unitType: "kg", selected: false, purchased: false },
                { name: "×‘×¦×œ", quantity: 0, unit: "×§×´×’", unitType: "kg", selected: false, purchased: false },
                { name: "×¤×œ×¤×œ ××“×•×", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×¤×œ×¤×œ ×™×¨×•×§", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×¤×œ×¤×œ ×¦×”×•×‘", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×§×™×©×•××™×", quantity: 0, unit: "×§×´×’", unitType: "kg", selected: false, purchased: false },
                { name: "×—×¦×™×œ×™×", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×ª×¤×•×—×™ ××“××”", quantity: 0, unit: "×§×´×’", unitType: "kg", selected: false, purchased: false },
                { name: "×¤×˜×¨×•×–×™×œ×™×”", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×›×•×¡×‘×¨×”", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×©××™×¨", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "× ×¢× ×¢", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×‘×¦×œ ×™×¨×•×§", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×—×¡×”", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×—×¡×” ×¢×’×•×œ×”", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×“×œ×¢×ª", quantity: 0, unit: "×§×´×’", unitType: "kg", selected: false, purchased: false },
                { name: "×“×œ×•×¨×™×ª", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false }
            ],
            "fruits-table": [
                { name: "×‘× × ×”", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×ª×¤×•×–×™×", quantity: 0, unit: "×§×´×’", unitType: "kg", selected: false, purchased: false },
                { name: "×ª×¤×•×—×™×", quantity: 0, unit: "×§×´×’", unitType: "kg", selected: false, purchased: false },
                { name: "×¢× ×‘×™×", quantity: 0, unit: "×§×´×’", unitType: "kg", selected: false, purchased: false },
                { name: "××¤×¨×¡×§×™×", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "××©××©", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "××‘×˜×™×—", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "××‘×•×§×“×•", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×ª×•×ª×™×", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "××œ×•×Ÿ", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×©×¡×§", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×§×™×•×•×™", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×“×•×‘×“×‘× ×™×", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×¡×‘×¨×¡", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false }
            ],
            "dairy-products-table": [
                { name: "×—×œ×‘ ×“×œ ×œ×§×˜×•×–", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false }, // ×¡×¤×¦×™×¤×™: ×¨×§ ×™×—×™×“×•×ª
                { name: "×’×‘×™× ×” ×¦×”×•×‘×” ××’×•×¨×“×ª", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×’×‘×™× ×ª ×˜×œ ×”×¢××§ ×¤×¨×•×¡×” ×“×§", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×× ×¦×³×’×• ×’×•×©", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×’×‘×™× ×ª ×©×× ×ª", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×’×‘×™× ×” ×œ×‘× ×”", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×§×•×˜×’×³", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×™×•×’×•×¨×˜", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×©×× ×ª ×œ×‘×™×©×•×œ", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×©×× ×ª ×œ×”×§×¦×¤×”", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×—×××”", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×©×× ×ª ×—××•×¦×” 9%", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×’×‘×™× ×ª ×¤×˜×” ×¤×™×¨××•×¡", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×’×‘×™× ×” ×¦×¤×ª×™×ª", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false }
            ],
            "meat-products-table": [
                { name: "×›×ª×£ 5", quantity: 0, unit: "×§×´×’", unitType: "kg", selected: false, purchased: false },
                { name: "×‘×©×¨ ×œ×‘×™×©×•×œ ××¨×•×š", quantity: 0, unit: "×§×´×’", unitType: "kg", selected: false, purchased: false },
                { name: "×¤×¨×’×™×•×ª", quantity: 0, unit: "×§×´×’", unitType: "kg", selected: false, purchased: false },
                { name: "×—×–×” ×¢×•×£", quantity: 0, unit: "×§×´×’", unitType: "kg", selected: false, purchased: false },
                { name: "×›×¨×¢×™×™×", quantity: 0, unit: "×§×´×’", unitType: "kg", selected: false, purchased: false },
                { name: "×©×•×§×™×™×", quantity: 0, unit: "×§×´×’", unitType: "kg", selected: false, purchased: false },
                { name: "×™×¨×›×™×™×", quantity: 0, unit: "×§×´×’", unitType: "kg", selected: false, purchased: false },
                { name: "×‘×©×¨ ×˜×—×•×Ÿ", quantity: 0, unit: "×§×´×’", unitType: "kg", selected: false, purchased: false },
                { name: "×‘×©×¨ ××¡×¤×¨ 8", quantity: 0, unit: "×§×´×’", unitType: "kg", selected: false, purchased: false },
                { name: "×‘×©×¨ ××¡×¤×¨ 2", quantity: 0, unit: "×§×´×’", unitType: "kg", selected: false, purchased: false },
                { name: "×›×‘×“", quantity: 0, unit: "×§×´×’", unitType: "kg", selected: false, purchased: false }
            ],
            "fish-products-table": [
                { name: "×¡×œ××•×Ÿ", quantity: 0, unit: "×§×´×’", unitType: "kg", selected: false, purchased: false },
                { name: "×¤×™×œ×” ××× ×•×Ÿ", quantity: 0, unit: "×§×´×’", unitType: "kg", selected: false, purchased: false },
                { name: "×“×’ ×©×œ×", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×§×¨×¤×™×•×Ÿ ×©×œ×", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×§×¨×¤×™×•×Ÿ ×˜×—×•×Ÿ", quantity: 0, unit: "×§×´×’", unitType: "kg", selected: false, purchased: false }
            ],
            "cleaning-items-table": [
                { name: "×¨×¡×¡ ×•× ×’×‘", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×¨×¡×¡ ×•×›×‘×¡", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "××•×§×•× ×•××™×§×”", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "× ×•×–×œ ×›×œ×™×", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "××¡×™×¨ ×©×•×× ×™×", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "××¡×™×¨ ×©×•×× ×™× ×§×¨", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×—×•××¨ ×œ×—×œ×•× ×•×ª", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×©××¤×•", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×¡×‘×•×Ÿ", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "××¨×›×š", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×¡×¤×•×’ ×œ×›×œ×™×", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×¡×¤×•×’ ×œ×¡×™×¨×™×", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×¡××¨×˜×•×˜×™×", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false }
            ],
            "legumes-table": [
                { name: "××•×¨×–", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "××•×¨×– ×™×¡××™×Ÿ", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "××•×¨×– ×¤×¨×¡×™", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "××•×¨×– ×‘×¡××ª×™", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×¢×“×©×™× ×™×¨×•×§×•×ª", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×¢×“×©×™× ×›×ª×•××•×ª", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×¢×“×©×™× ×©×—×•×¨×•×ª", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×—×•××•×¡", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×—×•××•×¡ ×¢× ×§", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false }
            ],
            "various-items-table": [
                { name: "×‘×™×¦×™×", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "××™×•× ×–", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false },
                { name: "×˜×—×™× ×”", quantity: 0, unit: "×™×—×™×“×•×ª", unitType: "units", selected: false, purchased: false }
            ]
        };

        // ×¤×•× ×§×¦×™×” ×œ×©××™×¨×ª ×”××¦×‘ ×œ-localStorage
        function saveItems() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(currentItems));
        }

        // ×¤×•× ×§×¦×™×” ×œ×˜×¢×™× ×ª ×”××¦×‘ ×-localStorage
        function loadItems() {
            const storedItems = localStorage.getItem(STORAGE_KEY);
            let loadedData;
            if (storedItems) {
                loadedData = JSON.parse(storedItems);
            } else {
                loadedData = {};
            }

            // ×¢×“×›×Ÿ ××ª currentItems ×¢× ×”× ×ª×•× ×™× ×”×©××•×¨×™×, ×ª×•×š ×›×“×™ ×”×‘×˜×—×” ×©×§×˜×’×•×¨×™×•×ª ××•×’×“×¨×•×ª ××¨××© ×§×™×™××•×ª
            for (const categoryId in initialProductsData) {
                if (!loadedData[categoryId]) {
                    loadedData[categoryId] = initialProductsData[categoryId];
                } else {
                    // ××™×–×•×’: × ×ª×•× ×™× ×©××•×¨×™× ×¢×•×§×¤×™× ×”×’×“×¨×•×ª ×¨××©×•× ×™×•×ª, ××‘×œ ×× ×—×¡×¨×™× - × ×™×§×— ××”×’×“×¨×•×ª ×¨××©×•× ×™×•×ª
                    loadedData[categoryId] = loadedData[categoryId].map(loadedItem => {
                        const initialItem = initialProductsData[categoryId]?.find(item => item.name === loadedItem.name);
                        return { ...initialItem, ...loadedItem }; // ××™×–×•×’ ××•×‘×™×™×§×˜×™×
                    });
                    // ×”×•×¡×£ ×¤×¨×™×˜×™× ×—×“×©×™× ××”-initialData ×©×œ× ×§×™×™××™× ×‘-loadedData
                    initialProductsData[categoryId].forEach(initialItem => {
                        if (!loadedData[categoryId].some(loadedItem => loadedItem.name === initialItem.name)) {
                            loadedData[categoryId].push(initialItem);
                        }
                    });
                }
            }

            // ×•×•×“× ×©×”-categoryMap ××¢×•×“×›×Ÿ
            document.querySelectorAll('div[id$="-div"]').forEach(categoryDiv => {
                const tableId = categoryDiv.querySelector('table[id$="-table"]').id;
                const h2Text = categoryDiv.querySelector('h2').textContent;
                categoryMap[tableId] = h2Text;
            });
            // ×¢×‘×•×¨ ×§×˜×’×•×¨×™×•×ª ×©× ×•×¡×¤×• ×“×™× ××™×ª (×œ× ×‘-initialProductsData)
            for (const categoryId in loadedData) {
                if (!categoryMap[categoryId]) {
                    const categoryDiv = document.getElementById(categoryId.replace('-table', '-div'));
                    if (categoryDiv) {
                        const h2Text = categoryDiv.querySelector('h2').textContent;
                        categoryMap[categoryId] = h2Text;
                    }
                }
            }

            return loadedData;
        }

        // ×¤×•× ×§×¦×™×” ×œ×¢×“×›×•×Ÿ ×ª×¦×•×’×ª ×”×›××•×ª ×”×¡×˜×˜×™×ª ×©×œ ×¤×¨×™×˜
        function updateQuantityDisplay(item, productItemDiv) {
            const quantityDisplaySpan = productItemDiv.querySelector('.quantity-display');
            if (quantityDisplaySpan) {
                // ×”×¦×’ ×¨×§ ×× ×™×© ×›××•×ª ×’×“×•×œ×” ×-0
                if (item.quantity > 0 && item.unit) {
                    quantityDisplaySpan.textContent = `${item.quantity} ${item.unit}`;
                } else {
                    quantityDisplaySpan.textContent = ''; // × ×§×” ×× ××™×Ÿ ×›××•×ª ××• ×™×—×™×“×”
                }
            }
        }

        // ×¤×•× ×§×¦×™×” ×œ×™×¦×™×¨×ª ××œ×× ×˜ TD ×¢×‘×•×¨ ×¤×¨×™×˜
        function createProductTdElement(item, categoryTableId) {
            const td = document.createElement('td');
            const productItemDiv = document.createElement('div');
            productItemDiv.className = 'product-item';
            productItemDiv.setAttribute('data-item', item.name);
            productItemDiv.setAttribute('data-category-table-id', categoryTableId);

            // ×”×“×’×©×”: ×§×œ××¡×™× ××‘×•×¡×¡×™× ×¢×œ ×”×××¤×™×™× ×™×
            if (item.selected) {
                productItemDiv.classList.add('selected-for-purchase');
            }
            if (item.purchased) {
                productItemDiv.classList.add('purchased');
            }

            // ×©× ×”××•×¦×¨
            const itemNameSpan = document.createElement('span');
            itemNameSpan.className = 'item-name';
            itemNameSpan.textContent = item.name;
            productItemDiv.appendChild(itemNameSpan);

            // ×‘×§×¨×ª ×›××•×ª ×•×™×—×™×“×ª ××™×“×”
            const quantityControlDiv = document.createElement('div');
            quantityControlDiv.className = 'quantity-control';

            // ×§×‘×œ×ª ×›×œ×œ×™ ×”×™×—×™×“×•×ª ×¢×‘×•×¨ ×”×§×˜×’×•×¨×™×”
            const rules = categoryUnitRules[categoryTableId] || { allowKg: true, allowUnits: true, defaultUnitType: "units" }; // ×‘×¨×™×¨×ª ××—×“×œ

            // ×˜×™×¤×•×œ ××™×•×—×“ ×‘"×—×œ×‘ ×“×œ ×œ×§×˜×•×–" - ×¨×§ ×™×—×™×“×•×ª
            const isMilk = item.name === "×—×œ×‘ ×“×œ ×œ×§×˜×•×–" && categoryTableId === "dairy-products-table";

            // ×›×¤×ª×•×¨ ×¨×“×™×• "×§"×’"
            const radioKg = document.createElement('input');
            const uniqueIdKg = `radio-${categoryTableId}-${item.name}-kg-${Math.random().toString(36).substring(7)}`;
            radioKg.id = uniqueIdKg;
            radioKg.type = 'radio';
            radioKg.name = `unit-type-${categoryTableId}-${item.name}-${Math.random().toString(36).substring(7)}`;
            radioKg.value = 'kg';
            
            const labelKg = document.createElement('label');
            labelKg.htmlFor = radioKg.id;
            labelKg.textContent = '×§×´×’';

            // ×›×¤×ª×•×¨ ×¨×“×™×• "×™×—×™×“×•×ª"
            const radioUnits = document.createElement('input');
            const uniqueIdUnits = `radio-${categoryTableId}-${item.name}-units-${Math.random().toString(36).substring(7)}`;
            radioUnits.id = uniqueIdUnits;
            radioUnits.type = 'radio';
            radioUnits.name = radioKg.name; // ×”×©×ª××© ×‘××•×ª×• ×©× ×§×‘×•×¦×”
            radioUnits.value = 'units';
            
            const labelUnits = document.createElement('label');
            labelUnits.htmlFor = radioUnits.id;
            labelUnits.textContent = '×™×—×™×“×•×ª';

            // ×§×‘×™×¢×ª ××¦×‘ ×‘×¨×™×¨×ª ×”××—×“×œ ×©×œ ×›×¤×ª×•×¨×™ ×”×¨×“×™×•
            if (isMilk) { // ×—×œ×‘ ×ª××™×“ ×™×—×™×“×•×ª
                radioUnits.checked = true;
                item.unitType = 'units'; // ×•×•×“× ×©× ×ª×•× ×™ ×”×¤×¨×™×˜ ××¢×•×“×›× ×™×
                item.unit = '×™×—×™×“×•×ª';
            } else if (item.unitType === 'kg') { // ×× ×”×¤×¨×™×˜ × ×©××¨ ×›-×§"×’
                radioKg.checked = true;
            } else if (item.unitType === 'units') { // ×× ×”×¤×¨×™×˜ × ×©××¨ ×›-×™×—×™×“×•×ª
                radioUnits.checked = true;
            } else if (rules.defaultUnitType === 'kg' && rules.allowKg) { // ×‘×¨×™×¨×ª ××—×“×œ ×§×˜×’×•×¨×™×”: ×§"×’
                radioKg.checked = true;
            } else { // ×‘×¨×™×¨×ª ××—×“×œ ×§×˜×’×•×¨×™×”: ×™×—×™×“×•×ª
                radioUnits.checked = true;
            }


            // ×”×¦×’/×”×¡×ª×¨ ×›×¤×ª×•×¨×™ ×¨×“×™×• ×‘×”×ª×× ×œ×›×œ×œ×™×
            if (rules.allowKg && !isMilk) { // ×× ×§"×’ ××•×ª×¨ ×•×–×” ×œ× ×—×œ×‘
                quantityControlDiv.appendChild(radioKg);
                quantityControlDiv.appendChild(labelKg);
            } else {
                radioKg.style.display = 'none'; // ×”×¡×ª×¨ ××ª ×›×¤×ª×•×¨ ×”×¨×“×™×• ×§"×’
                labelKg.style.display = 'none'; // ×”×¡×ª×¨ ××ª ×”×ª×•×•×™×ª ×§"×’
            }
            
            if (rules.allowUnits) {
                quantityControlDiv.appendChild(radioUnits);
                quantityControlDiv.appendChild(labelUnits);
            } else {
                radioUnits.style.display = 'none'; // ×”×¡×ª×¨ ××ª ×›×¤×ª×•×¨ ×”×¨×“×™×• ×™×—×™×“×•×ª
                labelUnits.style.display = 'none'; // ×”×¡×ª×¨ ××ª ×”×ª×•×•×™×ª ×™×—×™×“×•×ª
            }

            // ×©×“×” ×§×œ×˜ ×›××•×ª
            const quantityInput = document.createElement('input');
            quantityInput.type = 'number';
            quantityInput.value = item.quantity === 0 ? '' : item.quantity; // ×”×¦×’ ×¨×™×§ ×× ×”×›××•×ª ×”×™× 0
            quantityInput.min = "0"; // ×™×›×•×œ ×œ×”×™×•×ª 0
            quantityInput.step = "0.1";
            quantityInput.max = "99.9";
            quantityInput.setAttribute('onfocus', 'this.select()'); // ×¡××Ÿ ××ª ×”×ª×•×›×Ÿ ×‘×œ×—×™×¦×”

            quantityInput.oninput = (e) => {
                let value = e.target.value;
                // ×× ×§×” ×ª×•×•×™ ××™× ×•×¡ ××• ×›×œ ×ª×• ×œ× ×—×•×§×™ ×©×œ× ××¡×¤×¨ ××• × ×§×•×“×”
                value = value.replace(/[^0-9.]/g, ''); 
                
                // ×•×•×“× ×©××™×Ÿ ×™×•×ª×¨ ×× ×§×•×“×” ××—×ª
                const parts = value.split('.');
                if (parts.length > 2) {
                    value = parts[0] + '.' + parts.slice(1).join('');
                }

                if (value.indexOf('.') !== -1) {
                    // ×× ×™×© × ×§×•×“×”, ×•×•×“× ×©×™×© ×¨×§ ×¡×¤×¨×” ××—×ª ××—×¨×™ ×”× ×§×•×“×” (×›××• 1.5)
                    if (parts[1] && parts[1].length > 1) {
                        parts[1] = parts[1].slice(0, 1);
                        value = parts[0] + '.' + parts[1];
                    }
                    // ××’×‘×™×œ ×œ-2 ×¡×¤×¨×•×ª ×œ×¤× ×™ ×”× ×§×•×“×”
                    if (parts[0].length > 2) {
                        parts[0] = parts[0].slice(0, 2);
                        value = parts[0] + (parts[1] ? '.' + parts[1] : '');
                    }
                } else {
                    // ×× ××™×Ÿ × ×§×•×“×”, ××’×‘×™×œ ×œ-3 ×¡×¤×¨×•×ª
                    if (value.length > 3) {
                        value = value.slice(0, 3);
                    }
                }
                e.target.value = value;
                updateItemData(item, 'quantity', parseFloat(value) || 0); // ×× ×¨×™×§, ×™×•×’×“×¨ ×›-0
            };
            quantityInput.onblur = (e) => {
                const val = parseFloat(e.target.value);
                // ×× ×”×©×“×” ×¨×™×§ ××• ×”×¢×¨×š ×œ× ×—×•×§×™, × ×’×“×™×¨ ××•×ª×• ×›-0
                updateItemData(item, 'quantity', isNaN(val) ? 0 : val);
                // ×•×•×“× ×©×”×©×“×” ××¦×™×’ 0 ×× ×”×¢×¨×š ×”×•× 0
                if (isNaN(val) || val === 0) {
                    e.target.value = '';
                }
            };
            quantityControlDiv.appendChild(quantityInput);

            // Listener for radio button changes
            const updateUnitTypeAndUnit = () => {
                if (radioKg.checked) {
                    updateItemData(item, 'unitType', 'kg');
                    updateItemData(item, 'unit', '×§×´×’');
                } else { // radioUnits.checked
                    updateItemData(item, 'unitType', 'units');
                    updateItemData(item, 'unit', '×™×—×™×“×•×ª');
                }
            };
            radioKg.addEventListener('change', updateUnitTypeAndUnit);
            radioUnits.addEventListener('change', updateUnitTypeAndUnit);
            
            // ×”×¤×¢×œ ××ª updateUnitTypeAndUnit ×¤×¢× ××—×ª ×›×“×™ ×œ×”×’×“×™×¨ ××ª ×”××¦×‘ ×”×¨××©×•× ×™
            updateUnitTypeAndUnit();

            productItemDiv.appendChild(quantityControlDiv);

            // ×ª×¦×•×’×ª ×›××•×ª ×•×™×—×™×“×” ×‘××¦×‘ ×¨×©×™××ª ×§× ×™×•×ª (×¡×˜×˜×™)
            const quantityDisplaySpan = document.createElement('span');
            quantityDisplaySpan.className = 'quantity-display';
            productItemDiv.appendChild(quantityDisplaySpan);


            // ×›×¤×ª×•×¨×™ ×¤×¢×•×œ×”
            const itemActionsDiv = document.createElement('div');
            itemActionsDiv.className = 'item-actions';

            const selectBtn = document.createElement('button');
            selectBtn.className = 'select-btn';
            selectBtn.title = "×‘×—×¨/×‘×˜×œ ×‘×—×™×¨×” ×œ×¨×©×™××ª ×§× ×™×•×ª";
            selectBtn.textContent = 'ğŸ›’';
            itemActionsDiv.appendChild(selectBtn);

            const purchasedToggleBtn = document.createElement('button');
            purchasedToggleBtn.className = 'purchased-toggle-btn';
            purchasedToggleBtn.title = "×¡××Ÿ/×‘×˜×œ ×¡××Ÿ ×›× ×§× ×”";
            purchasedToggleBtn.textContent = 'âœ”';
            itemActionsDiv.appendChild(purchasedToggleBtn);

            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-btn';
            deleteBtn.title = "××—×§ ×¤×¨×™×˜";
            deleteBtn.textContent = 'âœ–';
            itemActionsDiv.appendChild(deleteBtn);

            productItemDiv.appendChild(itemActionsDiv);
            td.appendChild(productItemDiv);
            
            // ×¢×“×›×Ÿ ×ª×¦×•×’×ª ×›××•×ª ×•×™×—×™×“×” ×‘×¢×ª ×™×¦×™×¨×”
            updateQuantityDisplay(item, productItemDiv); 
            attachEventListeners(productItemDiv); // ×—×‘×¨ ××ª ×”×œ×™×¡× ×¨×™× ×œ×¤×¨×™×˜ ×©× ×•×¦×¨
            return td;
        }

        // ×¤×•× ×§×¦×™×” ×œ×¢×“×›×•×Ÿ × ×ª×•× ×™ ×¤×¨×™×˜ ×‘××‘× ×” ×”× ×ª×•× ×™× ×•×©××™×¨×”
        function updateItemData(item, key, value) {
            item[key] = value;
            saveItems();
            // ××¦× ××ª ×”-productItemDiv ×”××ª××™× ×•×¢×“×›×Ÿ ××ª ×”×ª×¦×•×’×” ×”×¡×˜×˜×™×ª
            // ×›×“×™ ×œ×× ×•×¢ ×™×¦×™×¨×” ××—×“×© ×©×œ ××œ×× ×˜×™× ×›×œ ×¤×¢×, × × ×¡×” ×œ××¦×•× ××ª ×”××œ×× ×˜ ×”×§×™×™×
            const productItemDiv = document.querySelector(`[data-category-table-id="${item.__categoryId}"][data-item="${item.name}"]`);
            if (productItemDiv) {
                updateQuantityDisplay(item, productItemDiv); 
            }
        }

        // ×¤×•× ×§×¦×™×” ×œ×¨×™× ×“×•×¨ ×”××•×¦×¨×™× ×‘×“×£
        let currentViewMode = 'all'; // 'all' or 'shopping-list'

        function renderItems(viewMode) {
            currentViewMode = viewMode;
            document.body.classList.toggle('shopping-list-mode', viewMode === 'shopping-list');

            // ×¢×“×›×Ÿ ××ª ×›×¤×ª×•×¨×™ ×”×•×•×˜×¡××¤: ×”×¡×ª×¨ ×‘××¦×‘ "×›×œ ×”××•×¦×¨×™×" ×•×”×¦×’ ×‘××¦×‘ "×¨×©×™××ª ×§× ×™×•×ª"
            const whatsappButtons = document.querySelectorAll('.whatsapp-button');
            whatsappButtons.forEach(btn => {
                btn.style.display = (viewMode === 'shopping-list') ? 'inline-block' : 'none';
            });
            const whatsappSettingsDiv = document.querySelector('.whatsapp-settings');
            whatsappSettingsDiv.style.display = (viewMode === 'shopping-list') ? 'flex' : 'none';


            for (const categoryId in currentItems) {
                const tableBody = document.getElementById(categoryId)?.querySelector('tbody');
                const categoryDiv = document.getElementById(categoryId.replace('-table', '-div'));
                
                if (!tableBody || !categoryDiv) continue; // ×•×•×“× ×©×”××œ×× ×˜×™× ×§×™×™××™×

                tableBody.innerHTML = ''; // × ×§×” ××ª ×”×ª×•×›×Ÿ ×”×§×™×™×
                let hasVisibleItemsInCategory = false;
                
                // ×¦×•×¨ ××¢×¨×š ×–×× ×™ ×›×“×™ ×œ×˜×¤×œ ×‘×¢××•×“×•×ª
                let currentRow = document.createElement('tr');
                let itemsInRow = 0;

                currentItems[categoryId].forEach(item => {
                    // ×”×•×¡×£ ××ª ×”-categoryId ×œ×¤×¨×™×˜ ×¢×¦××•, ×–×” ×™×¢×–×•×¨ ×‘-updateItemData
                    item.__categoryId = categoryId;

                    const shouldShowItem = 
                        (viewMode === 'all') || 
                        (viewMode === 'shopping-list' && item.selected && item.quantity > 0); 

                    if (shouldShowItem) {
                        const td = createProductTdElement(item, categoryId);
                        
                        // ×”×•×¡×£ TD ×œ×©×•×¨×” ×”× ×•×›×—×™×ª ××• ×¦×•×¨ ×©×•×¨×” ×—×“×©×”
                        if (itemsInRow === 2) { // ×× ×™×© ×›×‘×¨ 2 ×¤×¨×™×˜×™× ×‘×©×•×¨×”
                            tableBody.appendChild(currentRow); // ×”×•×¡×£ ××ª ×”×©×•×¨×” ×œ×˜×‘×œ×”
                            currentRow = document.createElement('tr'); // ×¦×•×¨ ×©×•×¨×” ×—×“×©×”
                            itemsInRow = 0;
                        }
                        currentRow.appendChild(td);
                        itemsInRow++;
                        hasVisibleItemsInCategory = true;
                    }
                });

                // ×”×•×¡×£ ××ª ×”×©×•×¨×” ×”××—×¨×•× ×” ×× ×™×© ×‘×” ×¤×¨×™×˜×™×
                if (itemsInRow > 0) {
                    tableBody.appendChild(currentRow);
                }

                // ×”×¡×ª×¨ ×§×˜×’×•×¨×™×” ×× ××™×Ÿ ×‘×” ×¤×¨×™×˜×™× ×‘××¦×‘ ×¨×©×™××ª ×§× ×™×•×ª
                if (viewMode === 'shopping-list') {
                    if (hasVisibleItemsInCategory) {
                        categoryDiv.classList.remove('category-hidden');
                    } else {
                        categoryDiv.classList.add('category-hidden');
                    }
                } else {
                    categoryDiv.classList.remove('category-hidden'); // ×ª××™×“ ×”×¦×’ ×‘××œ ×”×›×œ
                }
            }
            updateActiveButtons(); // ×¢×“×›×Ÿ ××ª ××¦×‘ ×”×›×¤×ª×•×¨×™×
        }


        // ×¤×•× ×§×¦×™×” ×œ×˜×™×¤×•×œ ×‘××™×¨×•×¢×™× ×¢×œ ×¤×¨×™×˜
        function attachEventListeners(productItemDiv) {
            const selectBtn = productItemDiv.querySelector('.select-btn');
            const deleteBtn = productItemDiv.querySelector('.delete-btn');
            const purchasedToggleBtn = productItemDiv.querySelector('.purchased-toggle-btn');
            
            const itemName = productItemDiv.getAttribute('data-item');
            const categoryTableId = productItemDiv.getAttribute('data-category-table-id');
            const item = currentItems[categoryTableId].find(i => i.name === itemName);

            if (!item) return; // ×œ×•×•×“× ×©×”×¤×¨×™×˜ ×§×™×™×

            // ×˜×™×¤×•×œ ×‘×œ×—×™×¦×” ×¢×œ ×›×¤×ª×•×¨ ×‘×—×™×¨×” (×¢×’×œ×”)
            if (selectBtn) { // ×•×•×“× ×©×”×›×¤×ª×•×¨ ×§×™×™×
                selectBtn.onclick = () => {
                    item.selected = !item.selected;
                    // ×× × ×‘×—×¨, ×•×•×“× ×©×”×›××•×ª ×”×™× ×œ×¤×—×•×ª 1 ×× ×”×™× 0
                    if (item.selected && item.quantity === 0) {
                        item.quantity = 1;
                        // ×¢×“×›×Ÿ ××ª ×©×“×” ×”×›××•×ª ×‘×××©×§ ×”××©×ª××© ×‘××•×¤×Ÿ ××™×™×“×™
                        const quantityInput = productItemDiv.querySelector('.quantity-control input[type="number"]');
                        if (quantityInput) {
                            quantityInput.value = item.quantity;
                        }
                    } else if (!item.selected && item.quantity > 0) {
                        // ×× ×‘×•×˜×œ×” ×”×‘×—×™×¨×” ××‘×œ ×™×© ×›××•×ª, ×”×©××¨ ××ª ×”×›××•×ª
                        // ××• ××¤×©×¨×•×ª: ×× ×‘×•×˜×œ×” ×”×‘×—×™×¨×”, × ××¤×¡ ×›××•×ª:
                        // item.quantity = 0; 
                        // const quantityInput = productItemDiv.querySelector('.quantity-control input[type="number"]');
                        // if (quantityInput) { quantityInput.value = ''; }
                    }
                    saveItems();
                    // ×ª××™×“ ×œ×¨× ×“×¨ ××—×“×© ×›×“×™ ×œ×”×‘×˜×™×— ×©×”×¢×™×¦×•×‘ ×•×”×¡×™× ×•×Ÿ × ×›×•× ×™×
                    renderItems(currentViewMode); 
                };
            }

            // ×˜×™×¤×•×œ ×‘×œ×—×™×¦×” ×¢×œ ×›×¤×ª×•×¨ ×§× ×™×™×” (×•×™)
            if (purchasedToggleBtn) { // ×•×•×“× ×©×”×›×¤×ª×•×¨ ×§×™×™×
                purchasedToggleBtn.onclick = () => {
                    item.purchased = !item.purchased;
                    saveItems();
                    // ×¨×§ ×¢×“×›×Ÿ ××ª ×”×§×œ××¡ ×¢×‘×•×¨ ×”×¤×¨×™×˜ ×”×¡×¤×¦×™×¤×™ ×‘××¦×‘ ×¨×©×™××ª ×§× ×™×•×ª
                    if (currentViewMode === 'shopping-list') {
                        productItemDiv.classList.toggle('purchased', item.purchased);
                    } else {
                        // ×‘××¦×‘ "×›×œ ×”××•×¦×¨×™×", ×× ××™×©×”×• ×× ×¡×” ×œ×¡××Ÿ ×›× ×§× ×” (×œ××¨×•×ª ×©×”×›×¤×ª×•×¨ ××•×¡×ª×¨), 
                        // ×–×” ×œ× ×××•×¨ ×œ×”×©×¤×™×¢ ×¢×œ ×”××¨××” ×©×œ ×”×§×• ×”×—×•×¦×”
                        // ××‘×œ ×›×Ÿ × ×¢×“×›×Ÿ ××ª ×”×××¤×™×™×Ÿ.
                    }
                };
            }

            // ×˜×™×¤×•×œ ×‘×œ×—×™×¦×” ×¢×œ ×›×¤×ª×•×¨ ××—×™×§×”
            if (deleteBtn) { // ×•×•×“× ×©×”×›×¤×ª×•×¨ ×§×™×™×
                deleteBtn.onclick = () => {
                    if (confirm(`×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª "${item.name}"?`)) {
                        currentItems[categoryTableId] = currentItems[categoryTableId].filter(i => i.name !== itemName);
                        saveItems();
                        renderItems(currentViewMode); // ×¨× ×“×¨ ××—×“×© ×œ××—×¨ ××—×™×§×”
                    }
                };
            }
        }

        // ×¤×•× ×§×¦×™×” ×œ×”×•×¡×¤×ª ×¤×¨×™×˜ ×—×“×©
        function addNewItem() {
            const newItemText = document.getElementById('new-item-text').value.trim();
            let newItemQuantity = parseFloat(document.getElementById('new-item-quantity-add').value);
            const categorySelect = document.getElementById('category-select');
            const categoryTableId = categorySelect.value;

            // ×× ×”×›××•×ª ×¨×™×§×” ××• ×œ× ××¡×¤×¨ ×ª×§×™×Ÿ, ×”×’×“×¨ ××•×ª×” ×›-0.
            if (isNaN(newItemQuantity) || newItemQuantity < 0) {
                newItemQuantity = 0;
            }

            if (!newItemText || !categoryTableId) {
                alert('×× × ×”×–×Ÿ ×©× ×¤×¨×™×˜ ×•×‘×—×¨ ×§×˜×’×•×¨×™×”.');
                return;
            }

            if (!currentItems[categoryTableId]) {
                currentItems[categoryTableId] = [];
            }
            // ×•×•×“× ×©×”×¤×¨×™×˜ ×œ× ×§×™×™× ×›×‘×¨ ×‘××•×ª×” ×§×˜×’×•×¨×™×”
            const existingItem = currentItems[categoryTableId].find(item => item.name === newItemText);
            if (existingItem) {
                alert(`×”×¤×¨×™×˜ "${newItemText}" ×›×‘×¨ ×§×™×™× ×‘×§×˜×’×•×¨×™×” ×–×•. × ×™×ª×Ÿ ×œ×¢×“×›×Ÿ ××ª ×”×›××•×ª ×©×œ×• ×™×©×™×¨×•×ª.`);
                return;
            }

            // ×§×‘×œ×ª ×›×œ×œ×™ ×”×™×—×™×“×•×ª ×¢×‘×•×¨ ×”×§×˜×’×•×¨×™×”
            const rules = categoryUnitRules[categoryTableId] || { allowKg: true, allowUnits: true, defaultUnitType: "units" };
            
            let newItemUnitType;
            let newItemUnit;

            // ×˜×™×¤×•×œ ××™×•×—×“ ×‘×©× ×”×¤×¨×™×˜ ×‘×”×•×¡×¤×” - ×× ×–×” "×—×œ×‘ ×“×œ ×œ×§×˜×•×–" ×‘×§×˜×’×•×¨×™×™×ª "××•×¦×¨×™ ×—×œ×‘"
            const isMilkAddMode = newItemText === "×—×œ×‘ ×“×œ ×œ×§×˜×•×–" && categoryTableId === "dairy-products-table";

            if (isMilkAddMode) {
                newItemUnitType = 'units';
                newItemUnit = '×™×—×™×“×•×ª';
            } else if (rules.allowKg && document.getElementById('add-unit-type-kg').checked) {
                newItemUnitType = 'kg';
                newItemUnit = '×§×´×’';
            } else { // ×‘×¨×™×¨×ª ××—×“×œ ××• ×× ×¨×§ ×™×—×™×“×•×ª ××•×ª×¨×•×ª
                newItemUnitType = 'units';
                newItemUnit = '×™×—×™×“×•×ª';
            }


            const newItem = {
                name: newItemText,
                quantity: newItemQuantity,
                unit: newItemUnit,
                unitType: newItemUnitType,
                selected: false,
                purchased: false
            };
            currentItems[categoryTableId].push(newItem);
            saveItems();
            renderItems(currentViewMode); // ×¨× ×“×¨ ××—×“×© ××ª ×›×œ ×”×¤×¨×™×˜×™× ×›×“×™ ×œ×•×•×“× ×ª×¦×•×’×” × ×›×•× ×”
            
            // × ×§×” ×©×“×•×ª
            document.getElementById('new-item-text').value = '';
            document.getElementById('new-item-quantity-add').value = '0'; // ××¤×¡ ×‘×—×–×¨×” ×œ-0
        }


        // ×¤×•× ×§×¦×™×” ×œ×”×•×¡×¤×ª ×§×˜×’×•×¨×™×” ×—×“×©×”
        function addNewCategory() {
            const newCategoryName = document.getElementById('new-category-name').value.trim();
            if (newCategoryName) {
                // ×™×¦×™×¨×ª ID ×™×™×—×•×“×™ ×œ×§×˜×’×•×¨×™×”
                const categoryId = newCategoryName.toLowerCase().replace(/\s+/g, '-') + '-table';

                if (document.getElementById(categoryId)) {
                    alert('×§×˜×’×•×¨×™×” ×‘×©× ×–×” ×›×‘×¨ ×§×™×™××ª!');
                    return;
                }

                // ×”×•×¡×¤×ª ×”-div ×•×”-table ×œ-DOM
                const containerDiv = document.querySelector('.container');
                const newCategoryDiv = document.createElement('div');
                newCategoryDiv.id = categoryId.replace('-table', '-div');
                newCategoryDiv.innerHTML = `
                    <h2>${newCategoryName}</h2>
                    <table id="${categoryId}"><tbody></tbody></table>
                `;
                // ×”×•×¡×£ ×œ×¤× ×™ ×¡×¢×™×£ ×”×•×¡×¤×ª ×¤×¨×™×˜ ××• ×§×˜×’×•×¨×™×”
                // × × ×¡×” ×œ×”×•×¡×™×£ ×œ×¤× ×™ ×”-add-new-item-section ×”×¨××©×•×Ÿ
                const firstAddNewItemSection = document.querySelector('.add-new-item-section');
                if (firstAddNewItemSection) {
                    containerDiv.insertBefore(newCategoryDiv, firstAddNewItemSection);
                } else {
                    containerDiv.appendChild(newCategoryDiv); // fallback ×× ××™×Ÿ ×¡×¢×™×¤×™ ×”×•×¡×¤×”
                }

                // ×”×•×¡×£ ××ª ×”×§×˜×’×•×¨×™×” ×”×—×“×©×” ×œ××‘× ×” ×”× ×ª×•× ×™×
                currentItems[categoryId] = [];
                categoryMap[categoryId] = newCategoryName; // ×¢×“×›×Ÿ ××ª ×”-map

                // ×”×•×¡×£ ×›×œ×œ×™ ×™×—×™×“×•×ª ×‘×¨×™×¨×ª ××—×“×œ ×œ×§×˜×’×•×¨×™×” ×”×—×“×©×”
                categoryUnitRules[categoryId] = { allowKg: true, allowUnits: true, defaultUnitType: "units" };


                saveItems();
                populateCategorySelect(); // ×¢×“×›×Ÿ ××ª ×¨×©×™××ª ×”×§×˜×’×•×¨×™×•×ª ×‘-select
                document.getElementById('new-category-name').value = ''; // × ×§×” ×©×“×”
                renderItems(currentViewMode); // ×¨× ×“×¨ ××—×“×© ×›×“×™ ×œ×•×•×“× ×©×”×§×˜×’×•×¨×™×” ×”×¨×™×§×” ××•×¤×™×¢×” (×× ×‘××¦×‘ "×”×›×œ")
            } else {
                alert('×× × ×”×–×Ÿ ×©× ×œ×§×˜×’×•×¨×™×” ×”×—×“×©×”.');
            }
        }


        // ×¤×•× ×§×¦×™×” ×œ××™×œ×•×™ ×”-select ×©×œ ×”×§×˜×’×•×¨×™×•×ª
        function populateCategorySelect() {
            const categorySelect = document.getElementById('category-select');
            categorySelect.innerHTML = ''; // × ×§×” ××¤×©×¨×•×™×•×ª ×§×•×“××•×ª

            // ×”×¤×•×š ××ª ×”-categoryMap ×œ××¢×¨×š, ××™×™×Ÿ ×œ×¤×™ ×©××•×ª ×§×˜×’×•×¨×™×•×ª
            const sortedCategories = Object.keys(categoryMap).map(id => ({ id, name: categoryMap[id] }))
                                    .sort((a, b) => a.name.localeCompare(b.name, 'he'));

            sortedCategories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = category.name;
                categorySelect.appendChild(option);
            });

            // ×”×¤×¢×œ ××ª ×¢×“×›×•×Ÿ ×”-UI ×©×œ ×™×—×™×“×•×ª ×”×”×•×¡×¤×” ×›×‘×¨×™×¨×ª ××—×“×œ ×¢×‘×•×¨ ×”×§×˜×’×•×¨×™×” ×©× ×‘×—×¨×” ×¨××©×•× ×”
            updateAddItemUnitUI();
        }


        // ×¤×•× ×§×¦×™×” ×œ×¢×“×›×•×Ÿ ×”-UI ×©×œ ×›×¤×ª×•×¨×™ ×”×¨×“×™×• ×‘"×”×•×¡×£ ×¤×¨×™×˜ ×—×“×©"
        function updateAddItemUnitUI() {
            const categorySelect = document.getElementById('category-select');
            const selectedCategoryTableId = categorySelect.value;
            const rules = categoryUnitRules[selectedCategoryTableId] || { allowKg: true, allowUnits: true, defaultUnitType: "units" };

            const addUnitTypeKgRadio = document.getElementById('add-unit-type-kg');
            const labelKg = document.querySelector('label[for="add-unit-type-kg"]');
            const addUnitTypeUnitsRadio = document.getElementById('add-unit-type-units');
            const labelUnits = document.querySelector('label[for="add-unit-type-units"]');

            // ×˜×™×¤×•×œ ××™×•×—×“ ×‘×©× ×”×¤×¨×™×˜ ×‘×”×•×¡×¤×” - ×× ×–×” "×—×œ×‘ ×“×œ ×œ×§×˜×•×–" ×‘×§×˜×’×•×¨×™×™×ª "××•×¦×¨×™ ×—×œ×‘"
            const newItemText = document.getElementById('new-item-text').value.trim();
            const isMilkAddMode = newItemText === "×—×œ×‘ ×“×œ ×œ×§×˜×•×–" && selectedCategoryTableId === "dairy-products-table";

            if (isMilkAddMode) {
                // ×”×¡×ª×¨ ×§"×’, ×”×¦×’ ×™×—×™×“×•×ª, ×•×¡××Ÿ ×™×—×™×“×•×ª
                addUnitTypeKgRadio.style.display = 'none';
                labelKg.style.display = 'none';
                addUnitTypeUnitsRadio.style.display = 'inline-block';
                labelUnits.style.display = 'inline-block';
                addUnitTypeUnitsRadio.checked = true;
            } else {
                // ×”×¦×’/×”×¡×ª×¨ ×›×¤×ª×•×¨×™ ×¨×“×™×• ×œ×¤×™ ×›×œ×œ×™ ×”×§×˜×’×•×¨×™×”
                addUnitTypeKgRadio.style.display = rules.allowKg ? 'inline-block' : 'none';
                labelKg.style.display = rules.allowKg ? 'inline-block' : 'none';
                addUnitTypeUnitsRadio.style.display = rules.allowUnits ? 'inline-block' : 'none';
                labelUnits.style.display = rules.allowUnits ? 'inline-block' : 'none';

                // ×‘×—×¨ ××ª ×›×¤×ª×•×¨ ×”×¨×“×™×• ×”× ×›×•×Ÿ ×›×‘×¨×™×¨×ª ××—×“×œ
                if (rules.allowKg && rules.defaultUnitType === "kg") {
                    addUnitTypeKgRadio.checked = true;
                } else if (rules.allowUnits && rules.defaultUnitType === "units") {
                    addUnitTypeUnitsRadio.checked = true;
                } else if (rules.allowKg) { // fallback if default not set or allowed and kg is available
                    addUnitTypeKgRadio.checked = true;
                } else if (rules.allowUnits) { // fallback if only units is available
                    addUnitTypeUnitsRadio.checked = true;
                }
            }
        }

        // ×¢×“×›×•×Ÿ ××¦×‘ ×”×›×¤×ª×•×¨×™× ×”×¨××©×™×™×
        function updateActiveButtons() {
            document.getElementById('show-all-btn').classList.toggle('active-mode', currentViewMode === 'all');
            document.getElementById('show-shopping-list-btn').classList.toggle('active-mode', currentViewMode === 'shopping-list');
        }

        // ×¤×•× ×§×¦×™×” ×œ×™×™×¦×•× ×¨×©×™××ª ×§× ×™×•×ª ×œ×•×•××˜×¡××¤
        function exportToWhatsApp() {
            let message = "×¨×©×™××ª ×”×§× ×™×•×ª ×©×œ×™:\n\n";
            let hasSelectedItems = false;
            let itemsByCategory = {}; // × ×©×ª××© ×‘××•×‘×™×™×§×˜ ×›×“×™ ×œ×§×‘×¥ ×¤×¨×™×˜×™× ×œ×¤×™ ×§×˜×’×•×¨×™×”

            // ×¢×‘×•×¨ ×¢×œ ×›×œ ×”×§×˜×’×•×¨×™×•×ª ×•×”×¤×¨×™×˜×™×
            for (const categoryId in currentItems) {
                // ××¡×•×£ ×¤×¨×™×˜×™× ×©×¡×•×× ×• ×œ×¢×’×œ×” ×•×™×© ×œ×”× ×›××•×ª ×’×“×•×œ×” ×-0
                currentItems[categoryId].forEach(item => {
                    if (item.selected && item.quantity > 0) {
                        const categoryName = categoryMap[categoryId] || categoryId.replace('-table', '');
                        if (!itemsByCategory[categoryName]) {
                            itemsByCategory[categoryName] = [];
                        }
                        itemsByCategory[categoryName].push(`${item.name}: ${item.quantity} ${item.unit}`);
                        hasSelectedItems = true;
                    }
                });
            }

            if (!hasSelectedItems) {
                alert('×œ× × ×‘×—×¨×• ×¤×¨×™×˜×™× ×œ×¨×©×™××ª ×”×§× ×™×•×ª. ×× × ×‘×—×¨ ×¤×¨×™×˜×™× ×‘×¢×–×¨×ª ×›×¤×ª×•×¨ "ğŸ›’"');
                return;
            }

            // ×‘× ×” ××ª ×”×”×•×“×¢×” ×”××¢×•×¦×‘×ª ××ª×•×š ×”-itemsByCategory
            for (const categoryName in itemsByCategory) {
                message += `*${categoryName}:*\n`;
                itemsByCategory[categoryName].forEach(itemText => {
                    message += `  - ${itemText}\n`;
                });
                message += "\n"; // ×¨×•×•×— ×‘×™×Ÿ ×§×˜×’×•×¨×™×•×ª
            }

            // × ×§×” ×¨×•×•×—×™× ××™×•×ª×¨×™× ×‘×¡×•×£ ×”×”×•×“×¢×”
            message = message.trim();

            // ×§×‘×œ×ª ××¡×¤×¨×™ ×”×˜×œ×¤×•×Ÿ ××©×“×” ×”×§×œ×˜
            const numbersInput = document.getElementById('whatsapp-numbers').value.trim();
            let phoneNumbers = numbersInput.split(',').map(num => num.trim()).filter(num => num !== '');

            // ×•×•×“× ×©××¡×¤×¨×™ ×”×˜×œ×¤×•×Ÿ ×ª×§×™× ×™× ×•××ª×—×™×œ×™× ×‘-972 (××• ×ª×•×¡×¤×ª +)
            phoneNumbers = phoneNumbers.map(num => {
                if (num.startsWith('05')) {
                    return '972' + num.substring(1); // ×××™×¨ 05xxxxxx ×œ-9725xxxxxx
                }
                if (num.startsWith('+972')) {
                    return num.substring(1); // ××¡×™×¨ + ×-+972xxxxxx
                }
                return num; // ××©××™×¨ ××¡×¤×¨×™× ××—×¨×™× ×›××• ×©×”× (×× ×›×‘×¨ ×‘×¤×•×¨××˜ ×‘×™× ×œ××•××™)
            });

            const encodedMessage = encodeURIComponent(message);
            
            // ×‘× ×” ××ª ×”×§×™×©×•×¨ ×‘×”×ª×× ×œ××¡×¤×¨×™×
            // ×©×™××•×© ×‘-wa.me/?text=... ×›×“×™ ×œ××¤×©×¨ ×œ××©×ª××© ×œ×‘×—×•×¨ × ××¢×Ÿ, ×©×–×• ×”×“×¨×š ×”×××™× ×” ×‘×™×•×ª×¨ ×œ××¡×¤×¨×™× ××¨×•×‘×™×
            const whatsappLink = `https://wa.me/?text=${encodedMessage}`;
            
            window.open(whatsappLink, '_blank');
        }


        // ××™×ª×—×•×œ ×”×“×£
        document.addEventListener('DOMContentLoaded', () => {
            currentItems = loadItems(); // ×˜×¢×Ÿ × ×ª×•× ×™× ×-localStorage
            populateCategorySelect(); // ××œ× ××ª ×¨×©×™××ª ×”×§×˜×’×•×¨×™×•×ª
            renderItems('all'); // ×”×¦×’ ××ª ×›×œ ×”××•×¦×¨×™× ×›×‘×¨×™×¨×ª ××—×“×œ
            
            document.getElementById('show-all-btn').addEventListener('click', () => renderItems('all'));
            document.getElementById('show-shopping-list-btn').addEventListener('click', () => renderItems('shopping-list'));

            // ×œ×•×’×™×§×” ×œ×‘×—×™×¨×ª ×¡×•×’ ×™×—×™×“×” (×§"×’/×™×—×™×“×•×ª) ×‘×”×•×¡×¤×ª ×¤×¨×™×˜ ×—×“×©
            document.getElementById('category-select').addEventListener('change', updateAddItemUnitUI);
            document.getElementById('add-unit-type-kg').addEventListener('change', updateAddItemUnitUI);
            document.getElementById('add-unit-type-units').addEventListener('change', updateAddItemUnitUI);
            document.getElementById('new-item-text').addEventListener('input', updateAddItemUnitUI); // ×¢×“×›×Ÿ ×›×©××§×œ×™×“×™× ×©× ×¤×¨×™×˜ (×œ×¦×•×¨×š "×—×œ×‘")
        });

    </script>
</body>
</html>